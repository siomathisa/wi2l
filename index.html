<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notation des Maillots</title>
  <link rel="icon" type="image/png" href="./favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      color: #f0f0f0;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }

    .drop-zone {
      border: 2px dashed #bb86fc;
      background-color: rgba(255, 255, 255, 0.05);
      padding: 2rem;
      border-radius: 2rem;
      margin-bottom: 2rem;
      cursor: pointer;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .drop-zone:hover {
      background-color: rgba(255, 255, 255, 0.1);
      border-color: #985eff;
    }

    .hidden {
      display: none;
    }

    img {
      max-width: 90vw;
      max-height: 300px;
      margin: 1rem 0;
      border-radius: 2rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    .note-section {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .note-box {
      border-radius: 2rem;
      padding: 1.5rem;
      width: 300px;
      background-color: #2d2a40;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease;
    }

    .note-box:hover {
      transform: translateY(-5px);
    }

    .note-box h3 {
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: #bb86fc;
    }

    .note-box span {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0.6rem 0;
    }

    .note-box input[type='number'] {
      width: 80px;
      padding: 0.4rem;
      font-size: 1rem;
      border-radius: 1rem;
      border: 1px solid #666;
      background-color: #3e3b4f;
      color: #fff;
    }

    button {
      margin: 1rem;
      padding: 0.8rem 2rem;
      font-size: 1rem;
      border: none;
      border-radius: 1rem;
      background: linear-gradient(135deg, #bb86fc, #985eff);
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    button:hover {
      transform: scale(1.05);
    }

    table {
      margin: 2rem auto;
      border-collapse: collapse;
      width: 95%;
      font-size: 0.95rem;
      background-color: #2a273a;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      border-radius: 1rem;
      overflow: hidden;
      color: #fff;
    }

    th,
    td {
      border: 1px solid #444;
      padding: 0.75rem;
    }

    th {
      background: linear-gradient(135deg, #bb86fc, #985eff);
      color: white;
      text-transform: uppercase;
      font-size: 0.85rem;
    }

    td img {
      max-width: 80px;
      height: auto;
    }

    tr:nth-child(even) td {
      background-color: #38354a;
    }

    #progress-indicator {
      font-weight: 600;
      font-size: 1.2rem;
      margin: 0.5rem 0;
      color: #f0f0f0;
    }

    .progress-bar {
      height: 12px;
      width: 90%;
      max-width: 600px;
      background-color: #4b445a;
      border-radius: 10px;
      margin: 0 auto 1rem;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #bb86fc, #985eff);
      transition: width 0.4s ease-in-out;
    }

    @media (max-width: 600px) {
      .note-section {
        flex-direction: column;
        align-items: center;
      }
    }

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      margin-bottom: 2rem;
    }

    @media (max-width: 600px) {
      table {
        font-size: 0.8rem;
      }

      th,
      td {
        padding: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <h1>Notation des Maillots</h1>
  <button id="toggle-mode">Mode : Duo</button>

  <div class="drop-zone" id="drop-zone">Glisser-déposer les images ici ou cliquer pour choisir</div>
  <input type="file" id="file-input" multiple accept="image/*" class="hidden">

  <div id="notation-zone" class="hidden">
    <p id="progress-indicator"></p>
    <div class="progress-bar">
      <div class="progress-bar-fill" id="progress-fill"></div>
    </div>
    <img id="maillot-img" src="">
    <form id="note-form">
      <div class="note-section" id="note-section"></div>
      <button type="submit">Valider la note</button>
    </form>
  </div>

  <div id="result-zone" class="hidden">
    <h2>Classement Final</h2>
    <div class="table-wrapper">
      <table id="results-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Maillot</th>
            <th>Total</th>
            <th id="william-header">Détail</th>
            <th id="mathis-header">Détail Mathis</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button onclick="location.reload()">Recommencer</button>
  </div>

  <script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const notationZone = document.getElementById('notation-zone');
    const resultZone = document.getElementById('result-zone');
    const maillotImg = document.getElementById('maillot-img');
    const noteForm = document.getElementById('note-form');
    const resultsTable = document.getElementById('results-table').querySelector('tbody');
    const noteSection = document.getElementById('note-section');
    const toggleModeBtn = document.getElementById('toggle-mode');
    const mathisHeader = document.getElementById('mathis-header');
    const williamHeader = document.getElementById('william-header');
    const progressIndicator = document.getElementById('progress-indicator');
    const progressFill = document.getElementById('progress-fill');

    let images = [];
    let currentIndex = 0;
    let scores = [];
    let mode = 'duo';
    let lockedMode = false;

    const fields = ['Beauté', 'Originalité', 'Classe', 'Facile à assembler', 'Beauté porté'];

    function generateInputs() {
      noteSection.innerHTML = '';

      const createBox = (name, prefix, showTitle = true) => {
        const box = document.createElement('div');
        box.className = 'note-box';
        if (showTitle) {
          box.innerHTML = `<h3>Notes de ${name}</h3>`;
        }
        fields.forEach(f => {
          const id = f.toLowerCase().normalize("NFD").replace(/[^\w]/g, '');
          const span = document.createElement('span');
          span.innerHTML = `<label>${f} :</label><input type="number" name="${prefix}_${id}" min="0" max="10" step="0.01" required>`;
          box.appendChild(span);
        });
        noteSection.appendChild(box);
      };

      if (mode === 'solo') {
        createBox('', 'w', false);
        mathisHeader.style.display = 'none';
        williamHeader.textContent = 'Détail';
      } else {
        createBox('William', 'w');
        createBox('Mathis', 'm');
        mathisHeader.style.display = '';
        williamHeader.textContent = 'Détail William';
      }
    }

    toggleModeBtn.addEventListener('click', () => {
      if (lockedMode) return;
      mode = mode === 'duo' ? 'solo' : 'duo';
      toggleModeBtn.textContent = `Mode : ${mode.charAt(0).toUpperCase() + mode.slice(1)}`;
      generateInputs();
    });

    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.borderColor = 'green'; });
    dropZone.addEventListener('dragleave', () => dropZone.style.borderColor = '#ccc');
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', () => handleFiles(fileInput.files));

    function handleFiles(files) {
      images = Array.from(files);
      if (images.length > 0) {
        dropZone.classList.add('hidden');
        toggleModeBtn.classList.add('hidden');
        lockedMode = true;
        showImage();
        notationZone.classList.remove('hidden');
        generateInputs();
      }
    }

    function showImage() {
      const reader = new FileReader();
      reader.onload = () => {
        maillotImg.src = reader.result;
        progressIndicator.textContent = `Maillot ${currentIndex + 1} / ${images.length}`;
        progressFill.style.width = `${((currentIndex + 1) / images.length) * 100}%`;
      };
      reader.readAsDataURL(images[currentIndex]);
    }

    noteForm.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(noteForm);

      const getValues = prefix => fields.map(f =>
        parseFloat(formData.get(`${prefix}_${f.toLowerCase().normalize("NFD").replace(/[^\w]/g, '')}`))
      );

      const william = getValues('w');
      const mathis = mode === 'duo' ? getValues('m') : [0, 0, 0, 0, 0];

      const totalWilliam = william.reduce((a, b) => a + b, 0);
      const totalMathis = mathis.reduce((a, b) => a + b, 0);

      scores.push({
        imageSrc: maillotImg.src,
        total: totalWilliam + totalMathis,
        william,
        mathis,
        totalWilliam,
        totalMathis
      });

      noteForm.reset();
      currentIndex++;
      if (currentIndex < images.length) {
        showImage();
      } else {
        notationZone.classList.add('hidden');
        showResults();
      }
    });

    function showResults() {
      scores.sort((a, b) => b.total - a.total);
      resultsTable.innerHTML = '';

      scores.forEach((s, i) => {
        const row = document.createElement('tr');
        const detailNote = mode === 'duo'
          ? `(W: ${s.totalWilliam.toFixed(2)}, M: ${s.totalMathis.toFixed(2)})`
          : `(Note : ${s.totalWilliam.toFixed(2)})`;
        row.innerHTML = `
          <td>${i + 1}</td>
          <td><img src="${s.imageSrc}" alt="maillot"></td>
          <td>${s.total.toFixed(2)}${mode === 'duo' ? '/100' : '/50'}<br>${detailNote}</td>
          <td>${fields.map((f, j) => `${f}: ${s.william[j]}`).join(', ')}</td>
          <td>${mode === 'duo' ? fields.map((f, j) => `${f}: ${s.mathis[j]}`).join(', ') : ''}</td>
        `;
        resultsTable.appendChild(row);
      });
      resultZone.classList.remove('hidden');
    }
  </script>
</body>

</html>